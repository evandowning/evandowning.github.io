
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="index, follow" />

  <link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400&family=Source+Sans+Pro:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://www.evandowning.com/theme/stylesheet/style.min.css">

    <link id="dark-theme-style" rel="stylesheet" type="text/css"
          media="(prefers-color-scheme: dark)"
    href="https://www.evandowning.com/theme/stylesheet/dark-theme.min.css">

    <link id="pygments-dark-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: dark)"
          href="https://www.evandowning.com/theme/pygments/monokai.min.css">
    <link id="pygments-light-theme" rel="stylesheet" type="text/css"
              media="(prefers-color-scheme: light), (prefers-color-scheme: no-preference)"
          href="https://www.evandowning.com/theme/pygments/monokai.min.css">



  <link rel="stylesheet" type="text/css" href="https://www.evandowning.com/theme/font-awesome/css/fontawesome.css">
  <link rel="stylesheet" type="text/css" href="https://www.evandowning.com/theme/font-awesome/css/brands.css">
  <link rel="stylesheet" type="text/css" href="https://www.evandowning.com/theme/font-awesome/css/solid.css">

  <link rel="stylesheet" type="text/css" href="https://www.evandowning.com/static/custom.css">

  <link rel="shortcut icon" href="https://www.evandowning.com/images/favicon.ico" type="image/x-icon">
  <link rel="icon" href="https://www.evandowning.com/images/favicon.ico" type="image/x-icon">

  <!-- Chrome, Firefox OS and Opera -->
  <meta name="theme-color" content="#333333">
  <!-- Windows Phone -->
  <meta name="msapplication-navbutton-color" content="#333333">
  <!-- iOS Safari -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <!-- Microsoft EDGE -->
  <meta name="msapplication-TileColor" content="#333333">

  <link href="https://www.evandowning.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Evan Downing Atom">


<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C0W4PHDF8Y"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C0W4PHDF8Y');
</script>
 

<meta name="author" content="Evan Downing" />
<meta name="description" content="Introduction Neo4j is a graph database implementation. It&#39;s used for creating large graphs to efficiently create and query various relationships. For an explanation on the differences between graph databases and relational database (like MySQL and PostgreSQL), see https://neo4j.com/developer/graph-db-vs-rdbms/. I required Neo4j for one of my projects …" />
<meta name="keywords" content="neo4j">


  <meta property="og:site_name" content="Evan Downing"/>
  <meta property="og:title" content="Benchmarking Neo4j"/>
  <meta property="og:description" content="Introduction Neo4j is a graph database implementation. It&#39;s used for creating large graphs to efficiently create and query various relationships. For an explanation on the differences between graph databases and relational database (like MySQL and PostgreSQL), see https://neo4j.com/developer/graph-db-vs-rdbms/. I required Neo4j for one of my projects …"/>
  <meta property="og:locale" content="en_US"/>
  <meta property="og:url" content="https://www.evandowning.com/benchmarking-neo4j.html"/>
  <meta property="og:type" content="article"/>
  <meta property="article:published_time" content="2019-05-19 00:00:00-04:00"/>
  <meta property="article:modified_time" content="2019-05-19 00:00:00-04:00"/>
  <meta property="article:author" content="https://www.evandowning.com/author/evan-downing.html">
  <meta property="article:section" content="coding-fun"/>
  <meta property="article:tag" content="neo4j"/>
  <meta property="og:image" content="https://www.evandowning.com/images/profile.png">

  <title>Evan Downing &ndash; Benchmarking Neo4j</title>


</head>
<body >

<aside>
  <div>
    <a href="https://www.evandowning.com/">
      <img src="https://www.evandowning.com/images/profile.png" alt="Evan Downing" title="Evan Downing">
    </a>

    <h1>
      <a href="https://www.evandowning.com/">Evan Downing</a>
    </h1>

    <p>Cybersecurity Researcher</p>


    <nav>
      <ul class="list">


            <li>
              <a target="_self"
                 href="https://www.evandowning.com/pages/about.html">
                About
              </a>
            </li>
            <li>
              <a target="_self"
                 href="https://www.evandowning.com/pages/projects.html">
                Projects
              </a>
            </li>

          <li>
            <a target="_self" href="https://docs.google.com/document/d/1sKsh88ZiiveotGS-KR4l-vESgfj_U_JifvH6nGat-Wk" >Resume</a>
          </li>
          <li>
            <a target="_self" href="https://docs.google.com/document/d/1UcXkHeRCKpBvlf4KyW92GKjyEeoiPgXGdW7ARPSa2L4" >CV</a>
          </li>
      </ul>
    </nav>

    <ul class="social">
      <li>
        <a class="sc-github"
           href="https://github.com/evandowning"
           target="_blank">
          <i class="fa-brands fa-github"></i>
        </a>
      </li>
      <li>
        <a class="sc-google"
           href="https://scholar.google.com/citations?user=SnJNwIAAAAAJ&hl=en"
           target="_blank">
          <i class="fa-brands fa-google"></i>
        </a>
      </li>
      <li>
        <a class="sc-linkedin"
           href="https://www.linkedin.com/in/evandowning/"
           target="_blank">
          <i class="fa-brands fa-linkedin"></i>
        </a>
      </li>
      <li>
        <a class="sc-mixcloud"
           href="https://www.mixcloud.com/evandowning/"
           target="_blank">
          <i class="fa-brands fa-mixcloud"></i>
        </a>
      </li>
    </ul>
  </div>

</aside>
  <main>

<nav>
  <a href="https://www.evandowning.com/">Home</a>

  <a href="/archives.html">Archives</a>
  <a href="/categories.html">Categories</a>
  <a href="/tags.html">Tags</a>

  <a href="https://www.evandowning.com/feeds/all.atom.xml">Atom</a>

</nav>

<article class="single">
  <header>
      
    <h1 id="benchmarking-neo4j">Benchmarking Neo4j</h1>
    <p>
      Posted on May 19, 2019 in <a href="https://www.evandowning.com/category/coding-fun.html">coding-fun</a>

        &#8226; 4 min read
    </p>
  </header>


  <div>
    <h1>Introduction</h1>
<p><a href="https://neo4j.com/">Neo4j</a> is a graph database implementation. It's used for creating large
graphs to efficiently create and query various relationships. For an explanation on the differences
between graph databases and relational database (like <a href="https://www.mysql.com/">MySQL</a> and <a href="https://www.postgresql.org/">PostgreSQL</a>),
see <a href="https://neo4j.com/developer/graph-db-vs-rdbms/">https://neo4j.com/developer/graph-db-vs-rdbms/</a>.</p>
<p>I required Neo4j for one of my projects and one of the issues we were running into was that it
was taking a long time to create our massive graphs (10s of millions of nodes with 100s of millions
of edges). We had read that Neo4j was completely capable of handling graphs of this size (and larger)
but couldn't figure out why our methods of creating our graphs were so slow.</p>
<p>Unfortunately I couldn't find anyone online who had done benchmarking on creating various sizes
of graphs using the different ways of creating a Neo4j graph (which I will explain below). So I thought
this was a great opportunity to write some code to test the various ways of creating Neo4j graphs
and share my results with anyone interested in answering the same question.</p>
<h1>Creating Neo4j Graphs the "Normal" Way</h1>
<p>When you first read Neo4j tutorials on creating graphs, they probably mention
something about <code>MERGE</code> for creating Nodes and <code>CREATE</code> for creating Edges.
<code>MERGE</code> is helpful because it will simultaneously check and create a unique node
if it does not exist. If <code>MERGE</code> didn't exist, you would have to create some <code>MATCH</code>
condition to say "if this node doesn't exist yet, create it". In the graphs for my
project, all of the nodes and edges had to be unique.</p>
<p>Our <strong>first</strong> implementation just contained those simple queries: Create a node
and create an edge. That ended up being very slow (taking 40 seconds to create a graph
with 1000 nodes and 1000 edges). So the <strong>second</strong> thing we tried
was creating each node and edge in the same query (as opposed to creating each
individual node and edge within individual queries). Another thing we added
was creating all nodes and edges first and then creating the remaining unconnected
nodes at the end. We also tried adding an <code>INDEX</code> to each node as well.
This implementation was faster than the first, but still too slow for our needs.
Our test graph (1000 nodes and 1000 edges) took roughly 30 seconds to create.</p>
<p>Then we found a query called a <code>CONSTRAINT</code> which allows the user to create some
logical rule for the graph database to follow. For us, it was to only accept
unique nodes and edges. But this <strong>third</strong> implementation also wasn't very fast.
Finally we tried getting rid of both <code>INDEX</code> and <code>CONSTRAINT</code> to see if that
was bogging anything down, but to no avail. Our <strong>fourth</strong> implementation had
failed us.</p>
<p>We then created a <strong>batch</strong> implementation where we would batch multiple queries
into one (a similar technique used on relational databases). Unfortunately
this ended up being slower than our first implementation. Needless to say we
were frustrated, but knew there must be a solution that Neo4j provides us.</p>
<h1>Pause for Consideration</h1>
<p>These timings may sound fast to someone with sufficiently small graphs, but it would take
us nearly 10 days to create a single graph with 10s of millions of nodes
and 100s of millions of edges (which was way too slow for our needs). Our
particular application required streaming graph data to our server where we
would need to create these large graphs in realtime (and 10 days was barely
realtime). Also we noticed that creating the graphs slowed over time as the
graph size grew, so our guestimate of 10 days was actually much smaller compared
to what we experienced in reality.</p>
<h1>Creating Neo4j Graphs the Efficient Way</h1>
<p>After scouring the Internet for a day or so, we happened upon two
query methods used to create graphs quickly: <code>UNWIND</code> and <code>LOADCSV</code>.</p>
<p>One can think of <code>UNWIND</code> as the proper way to use batching in Neo4j
(like we had tried to emulate above for batching for relational databases).
Immediately we saw fantastic results. The time it took to create a graph
decreased by an order of magnitude (our 1000 node 1000 edge graph took
seconds). Unfortunately during our evaluation of our project, it still
was slower than realtime after a day or so of running it with our streaming
data. It eventually caught up, but after several days of letting it run
after our streaming data stopped after 2 weeks.</p>
<p>Finally we found the best implementation. <code>LOADCSV</code> is by far the
fastest way to create large graphs. It had been touted as being able
to create a 30 million node graph in minutes <a href="https://neo4j.com/blog/import-10m-stack-overflow-questions/">https://neo4j.com/blog/import-10m-stack-overflow-questions/</a>.
When we implemented using it ourselves it decreased our graph creation
time down to 0.17 seconds. Another order of magnitude difference!</p>
<p>But we were also curious in knowing how much different types and
sizes of graphs affected the creation time. Below are various
timing bar charts of our results:</p>
<h2>10 nodes, 10 edges</h2>
<p align="center">
  <img src="/images/coding-fun/neo4j_fig/10x10.png">
</p>

<h2>1000 nodes, 1000 edges</h2>
<p align="center">
  <img src="/images/coding-fun/neo4j_fig/1000x1000.png">
</p>

<h2>1000 nodes, 10 edges (sparse graph)</h2>
<p align="center">
  <img src="/images/coding-fun/neo4j_fig/1000x10.png">
</p>

<h2>10 nodes, 1000 edges (dense graph)</h2>
<p align="center">
  <img src="/images/coding-fun/neo4j_fig/10x1000.png">
</p>

<h1>Conclusion</h1>
<p>If you're creating a large graph in Neo4j, use <code>LOADCSV</code>.</p>
<p>You can check out all of my source code used to perform my experiments to test for yourself:
<a href="https://github.com/evandowning/neo4j-benchmark">https://github.com/evandowning/neo4j-benchmark</a></p>
  </div>
  <div class="tag-cloud">
    <p>
      <a href="https://www.evandowning.com/tag/neo4j.html">neo4j</a>
    </p>
  </div>






</article>

<footer>
<p>
  &copy; 2024  - This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/deed.en_US" target="_blank">Creative Commons Attribution-ShareAlike 4.0 International License</a>
</p>
<p>
Built with <a href="http://getpelican.com" target="_blank">Pelican</a> using <a href="http://bit.ly/flex-pelican" target="_blank">Flex</a> theme
  <span class="footer-separator">|</span>
  Switch to the <a href="javascript:void(0)" onclick="theme.switch(`dark`)">dark</a> | <a href="javascript:void(0)" onclick="theme.switch(`light`)">light</a> | <a href="javascript:void(0)" onclick="theme.switch(`browser`)">browser</a> theme
  <script id="dark-theme-script"
          src="https://www.evandowning.com/theme/dark-theme/dark-theme.min.js"
          data-enable-auto-detect-theme="True"
          data-default-theme="light"
          type="text/javascript">
  </script>
</p><p>
  <a rel="license"
     href="http://creativecommons.org/licenses/by-sa/4.0/"
     target="_blank">
    <img alt="Creative Commons License"
         title="Creative Commons License"
         style="border-width:0"
           src="https://i.creativecommons.org/l/by-sa/4.0/80x15.png"
         width="80"
         height="15"/>
  </a>
</p></footer>  </main>

<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " Evan Downing ",
  "url" : "https://www.evandowning.com",
  "image": "https://www.evandowning.com/images/profile.png",
  "description": ""
}
</script>
</body>
</html>